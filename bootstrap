#!/bin/bash

sudo chmod +x -R run_all.sh scripts/*

echo -en "Verifying required packages\n"

if [ -f /etc/redhat-release ]; then
	sudo rpm -ivh dependencies/python-devel-2.7.5-80.el7_6.x86_64.rpm --nodeps
	sudo yum install dependencies/rpms/* --nogpgcheck -y
	sudo rpm -ivh dependencies/perl/* --nodeps
fi

if [ -f certificates/Citi_DEVELOPMENT_chain.pem ]; then
  sudo cp certificates/Citi_DEVELOPMENT_chain.pem /etc/pki/ca-trust/source/anchors/
  sudo update-ca-trust extract
fi

virtualenv --no-site-packages --distribute virtualenv
virtualenv/bin/pip install --upgrade pip --no-index --find-links="dependencies/pip/"
virtualenv/bin/pip install setuptools==32.3.1 --no-index --find-links="dependencies/pip/"
virtualenv/bin/pip install -r requirements.txt --no-index --find-links="dependencies/pip/"
virtualenv/bin/python setup.py develop

pip install -r requirements-local.txt --no-index --user --find-links="dependencies/pip/"

echo -en "Build complete\n"
